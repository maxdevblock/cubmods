%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}


    \usepackage{upgreek}
    

\title{CUBmods}
\date{Sep 27, 2024}
\release{0.0.1}
\author{Massimo Pierini}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{Introduction}
\label{\detokenize{intro:introduction}}\label{\detokenize{intro::doc}}

\section{Preface}
\label{\detokenize{intro:preface}}
\sphinxAtStartPar
This package has been implemented by Massimo Pierini as a Bachelor’s thesis (\hyperlink{cite.references:id41}{Pierini, 2024}).

\sphinxAtStartPar
It is the first implementation of CUB class models in Python and is mainly based upon
the work of Domenico Piccolo and the \sphinxcode{\sphinxupquote{CUB}} package in R (\hyperlink{cite.references:id22}{Iannario \sphinxstyleemphasis{et al.}, 2022}),
mainteined by Rosaria Simone.


\section{Background}
\label{\detokenize{intro:background}}
\sphinxAtStartPar
The class of CUB (Combination of Uniform and Binomial) models, proposed by Professor Domenico Piccolo in
2003 (\hyperlink{cite.references:id4}{Piccolo, 2003}) within the cotext of rating and preference data analysis, hypothesizes that
the ordinal responses provided by the raters are not the simple result of a reasoned choice, but rather the
complex combination of a multitude of factors, both internal and external.

\sphinxAtStartPar
Simplifying, two main components can be distinguished:
\sphinxstyleemphasis{feeling} and \sphinxstyleemphasis{uncertainty}.

\sphinxAtStartPar
The primary component of feeling
is due to sufficient awareness and understanding of the topic based on
knowledge and experience.
The secondary component of uncertainty is instead generated by an \sphinxstyleemphasis{intrinsic fuzziness}, due to
various circumstances: limited knowledge, lack of interest, timing of the survey, method of
administration, boredom, and so on.

\sphinxAtStartPar
The simplest way to consider these
two aspects is a distribution resulting from a
mixture of a shifted Binomial component for the first and Uniform Discrete for the
second which takes the form of the CUB family models, subsequently
extended to consider further factors such as the overdispersion of
Binomial component, the effect of shelter choice, and so on.

\sphinxAtStartPar
The most updated paper by \hyperlink{cite.references:id3}{Piccolo and Simone, 2019} will be used as a reference for
terminology, theory and inferential issues.


\section{Motivation}
\label{\detokenize{intro:motivation}}
\sphinxAtStartPar
Currently the class of CUB models has been implemented in statistical and econometric programming languages
such as R (\hyperlink{cite.references:id22}{Iannario \sphinxstyleemphasis{et al.}, 2022}), Stata (\hyperlink{cite.references:id28}{Cerulli \sphinxstyleemphasis{et al.}, 2021}),
Gretl (\hyperlink{cite.references:id29}{Simone \sphinxstyleemphasis{et al.}, 2019})
and GAUSS (\hyperlink{cite.references:id7}{Piccolo, 2006}).  However, given the recent increase in the development
of the Python programming language also in the statistical field (\hyperlink{cite.references:id27}{Pittard and Li, 2020}),
their implementation in
this environment could be useful to the scientific community.


\section{Notes}
\label{\detokenize{intro:notes}}
\sphinxAtStartPar
To simplify the notation, the complete matrix of the covariates will be occasionally
indicated by \(\pmb T\) and the column vector of model’s parameters by \(\pmb\theta\).

\sphinxAtStartPar
Generally speaking, for models with covariates three different probability functions are available:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{.pmfi()}} (probability distribution matrix)}\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb\theta; \pmb T_i),
\left\{
\begin{array}{l}
i=1,\ldots,n
\\
r=1,\ldots,m
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
which is a matrix \(n \times m\) of the probability distribution for each \(i\)\sphinxhyphen{}th subject
given the estimated parameters and the covariates. This is an auxiliary function
for \sphinxcode{\sphinxupquote{.draw()}}. Notice that each row sums to 1, i.e.
\begin{equation*}
\begin{split}\sum_{r=1}^m \Pr(R_i=r|\pmb\theta; \pmb T_i) = 1,\; \forall i\end{split}
\end{equation*}
\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{.pmf()}} (average probability distribution)}\begin{equation*}
\begin{split}\frac{1}{n} \sum_{i=1}^n \Pr(R_i=r|\pmb\theta; \pmb T_i),\; r=1,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
which is a row vector \(1 \times m\) of the average probability given the
estimated parameters and the covariates. This is an auxiliary function
of \sphinxcode{\sphinxupquote{.plot\_ordinal()}}. Notice that it sums to 1 because
\begin{equation*}
\begin{split}\begin{align*}
\sum_{r=1}^m \frac{1}{n} \sum_{i=1}^n \Pr(R_i=r|\pmb\theta; \pmb T_i)
&= \frac{1}{n} \sum_{i=1}^n \; \sum_{r=1}^m \Pr(R_i=r|\pmb\theta; \pmb T_i)
\\&= \frac{1}{n} \sum_{i=1}^n 1 = \frac{1}{n} n = 1
\end{align*}\end{split}
\end{equation*}
\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{.prob()}} (observed sample probability)}\begin{equation*}
\begin{split}\Pr(R_i=r_i|\pmb\theta;\pmb T_i),\; i=1,\ldots,n\end{split}
\end{equation*}
\sphinxAtStartPar
which is a column vector \(n \times 1\) of the probabilities for each \(i\)\sphinxhyphen{}th subject
of the observed response \(r_i\) given the estimated parameters and the covariates.
This has not been implemented for all models and can be an auxiliary function
of \sphinxcode{\sphinxupquote{.loglik()}}. Notice that usually it doesn’t sum to 1.

\end{description}

\end{enumerate}

\begin{DUlineblock}{0em}
\item[] 
\item[] 
\item[] 
\end{DUlineblock}

\sphinxstepscope


\chapter{Manual}
\label{\detokenize{manual:manual}}\label{\detokenize{manual::doc}}
\sphinxAtStartPar
The package \sphinxcode{\sphinxupquote{cubmods}} can be used to build models within the CUB class
given an observed sample (and, eventually, the covariance matrix)
in order to estimate the parameters. Also, for each family,
random samples can be drawn from a specified model.

\sphinxAtStartPar
Currently, six families have been defined and implemented:
\begin{itemize}
\item {} 
\sphinxAtStartPar
CUB (Combination of Uniform and Binomial)

\item {} 
\sphinxAtStartPar
CUBSH (CUB + a SHelter choice)

\item {} 
\sphinxAtStartPar
CUSH (Combination of Uniform and a SHelter choice)

\item {} 
\sphinxAtStartPar
CUSH2 (Combination of Uniform and 2 SHelter choices)

\item {} 
\sphinxAtStartPar
CUBE (Combination of Uniform and BEta\sphinxhyphen{}binomial)

\item {} 
\sphinxAtStartPar
IHG (Inverse HyperGeometric)

\end{itemize}

\sphinxAtStartPar
For each family, a model can be defined with or without covariates for one or more parameters.

\sphinxAtStartPar
Details about each family and examples are provided in the following chapters.

\sphinxAtStartPar
Even if each family has got its own \sphinxstyleemphasis{Maximum Likelihood Estimation} function \sphinxcode{\sphinxupquote{mle()}} that
could be called directly, for example \sphinxcode{\sphinxupquote{cub.mle()}}, the function \sphinxcode{\sphinxupquote{gem.estimate()}} provides a
simplified and generalised procedure for MLE.

\sphinxAtStartPar
Similarly, even if each family has got its own \sphinxstyleemphasis{Random Sample Drawing} function \sphinxcode{\sphinxupquote{draw()}} that
could be called directly, for example \sphinxcode{\sphinxupquote{cub.draw()}}, the function \sphinxcode{\sphinxupquote{gem.draw()}} provides a
simplified and generalised procedure to draw a random sample.

\sphinxAtStartPar
In this manual \sphinxcode{\sphinxupquote{gem}} functions will be used for the examples.

\sphinxAtStartPar
Notice that, the Dissimilarity index is computed for models with covariates also:
it should be interpreted as the fraction of the sample to be changed to achive a
perfect fit to the estimated average probability distribution (see
\sphinxhref{intro.html}{Introduction} Notes).

\sphinxAtStartPar
The last chapter, shows the basic usage for the tool \sphinxcode{\sphinxupquote{multicub}}.


\section{GeM usage}
\label{\detokenize{manual:gem-usage}}\label{\detokenize{manual:gem-manual}}
\sphinxAtStartPar
GeM (Generalized Mixture) is the main module of \sphinxcode{\sphinxupquote{cubmods}} package, which provides simplified and
generalized functions to both estimate a model from an observed sample and draw a random sample from a
specified model.

\sphinxAtStartPar
The function \sphinxcode{\sphinxupquote{gem.estimate()}} is the main function for the estimation and
validation of a model from an observed sample, calling for the corresponding \sphinxcode{\sphinxupquote{.mle()}} function of
the specified family, with or without covariates.

\sphinxAtStartPar
The function \sphinxcode{\sphinxupquote{gem.draw()}} is the main function for drawing a random sample from a specified model,
calling for the corresponding \sphinxcode{\sphinxupquote{.draw()}} function of the corresponding family,
with or without covariates.

\sphinxAtStartPar
\sphinxhref{cubmods.html\#gem-module}{Reference guide}


\subsection{The \sphinxstyleemphasis{formula} syntax}
\label{\detokenize{manual:the-formula-syntax}}
\sphinxAtStartPar
Both functions need a \sphinxcode{\sphinxupquote{formula}} that is a \sphinxstylestrong{string} specifying the name of the ordinal
variable (before the tilde \sphinxcode{\sphinxupquote{\textasciitilde{}}} symbol)
and of the covariates of the components (after the tilde symbol \sphinxcode{\sphinxupquote{\textasciitilde{}}}).
Covariates for each component are
separated by the pipeline symbol \sphinxcode{\sphinxupquote{|}}.
The \sphinxstyleemphasis{zero} symbol \sphinxcode{\sphinxupquote{0}} indicates no covariates for a certain component.
The \sphinxstyleemphasis{one} symbol \sphinxcode{\sphinxupquote{1}} indicates that we want to estimate the parameter of the constant term only.
If more covariates explain a single component, the symbol \sphinxcode{\sphinxupquote{+}} concatenates the names.
Qualitative variables names, must be placed between brackets \sphinxcode{\sphinxupquote{()}} leaded by a \sphinxcode{\sphinxupquote{C}},
for example \sphinxcode{\sphinxupquote{C(varname)}}.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
No columns in the DataFrame should be named \sphinxcode{\sphinxupquote{constant}}, \sphinxcode{\sphinxupquote{1}} or \sphinxcode{\sphinxupquote{0}}.
In the column names, only letters, numbers, and underscores \sphinxcode{\sphinxupquote{\_}} are allowed.
Spaces \sphinxstylestrong{SHOULD NOT BE} used in the column names, but replaced with \sphinxcode{\sphinxupquote{\_}}.
\end{sphinxadmonition}

\sphinxAtStartPar
For example, let’s suppose we have a DataFrame where \sphinxcode{\sphinxupquote{response}} is the ordinal variable,
\sphinxcode{\sphinxupquote{age}} and \sphinxcode{\sphinxupquote{sex}} are respectively a quantitative and a qualitative variable to explain the \sphinxstyleemphasis{feeling} component
only, in a \sphinxcode{\sphinxupquote{cub}} family model. The formula will be \sphinxcode{\sphinxupquote{formula = "response \textasciitilde{} 0 | age + C(sex)"}}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Python will automatically order qualitative variables in alphanumeric order. So, for
instance, a variable \sphinxcode{\sphinxupquote{sex}} with two categories \sphinxcode{\sphinxupquote{"M"}} and \sphinxcode{\sphinxupquote{"F"}} will be ordered as
\sphinxcode{\sphinxupquote{{[}"F", "M"{]}}} thus the dummy variabile will be equal to \sphinxcode{\sphinxupquote{0}} where \sphinxcode{\sphinxupquote{sex=="F"}} and equal
to \sphinxcode{\sphinxupquote{1}} where otherwise \sphinxcode{\sphinxupquote{sex=="M"}}. Consequently, the estimated parameters will be the
\sphinxcode{\sphinxupquote{constant}} for \sphinxcode{\sphinxupquote{sex=="F"}} and \sphinxcode{\sphinxupquote{C.sex\_M}} for \sphinxcode{\sphinxupquote{sex=="M"}}. If you want a different order
for the categorical variables, you must specify it in \sphinxstyleemphasis{DataFrame}, for instance with the
\sphinxcode{\sphinxupquote{pandas}} funtion \sphinxcode{\sphinxupquote{Categorical}}. In the example:
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id37}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{sex}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Categorical}\PYG{p}{(}
    \PYG{n}{df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{sex}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{categories}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{M}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{F}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{ordered}\PYG{o}{=}\PYG{k+kc}{True}
\PYG{p}{)}
\end{sphinxVerbatim}
\end{sphinxadmonition}

\sphinxAtStartPar
Notice that spaces are allowed between symbols and variable names in the formula but they aren’t
needed: a formula \sphinxcode{\sphinxupquote{"ord \textasciitilde{} X | Y1 + Y2 | Z"}} is the same as \sphinxcode{\sphinxupquote{"ord\textasciitilde{}X|Y1+Y2|Z"}}.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
The number of fields separated by the pipeline \sphinxcode{\sphinxupquote{|}} in a formula \sphinxstylestrong{MUST BE} equal to
the number of parameters specifying the model family. Therefore: two for \sphinxcode{\sphinxupquote{cub}} and \sphinxcode{\sphinxupquote{cush2}},
three for \sphinxcode{\sphinxupquote{cube}} and \sphinxcode{\sphinxupquote{cub}} with shelter effect, one for \sphinxcode{\sphinxupquote{cush}} and \sphinxcode{\sphinxupquote{ihg}}.
\end{sphinxadmonition}


\subsection{Arguments of \sphinxstyleliteralintitle{\sphinxupquote{estimate}} and \sphinxstyleliteralintitle{\sphinxupquote{draw}}}
\label{\detokenize{manual:arguments-of-estimate-and-draw}}
\sphinxAtStartPar
Within the function \sphinxcode{\sphinxupquote{estimate}} the number of ordinal categories \sphinxcode{\sphinxupquote{m}} is internally retrieved if not specified
(taking the maximum observed category)
but it is advisable to pass it as an argument to the call if some category has zero frequency.
Within the function \sphinxcode{\sphinxupquote{draw}} instead, the number of ordinal categories \sphinxcode{\sphinxupquote{m}} must always be specified.

\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{pandas}} DataFrame must always be passed to the function \sphinxcode{\sphinxupquote{estimate}}, with the \sphinxstyleemphasis{kwarg}
(keyword argument) \sphinxcode{\sphinxupquote{df}}.
It should contain, at least, a column of the observed sample and the columns of the covariates (if any).
If no \sphinxcode{\sphinxupquote{df}} is passed to the function \sphinxcode{\sphinxupquote{draw}} for a model without covariates
instead, an empty DataFrame will be created.

\sphinxAtStartPar
The number \sphinxcode{\sphinxupquote{n}} of ordinal responses to be drawn should always be specified in the function \sphinxcode{\sphinxupquote{draw}}
for models without covariates. For model with covariates instead, \sphinxcode{\sphinxupquote{n}} is not effective because
the number of drawn ordinal responses will be equal to the passed DataFrame rows.

\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{seed}} could be specified for the function \sphinxcode{\sphinxupquote{draw}} to ensure reproducibility.
Notice that, for models with covariates, \sphinxcode{\sphinxupquote{seed}} cannot be \sphinxcode{\sphinxupquote{0}} (in case, it will be
automatically set to \sphinxcode{\sphinxupquote{1}}).

\sphinxAtStartPar
If no \sphinxcode{\sphinxupquote{model}} is declared, the function takes \sphinxcode{\sphinxupquote{"cub"}} as default.
Currently implemented models are: \sphinxcode{\sphinxupquote{"cub"}} (default), \sphinxcode{\sphinxupquote{"cush"}}, \sphinxcode{\sphinxupquote{"cube"}},
and \sphinxcode{\sphinxupquote{"ihg"}}. CUB models with shelter effect are automatically
implemented using \sphinxcode{\sphinxupquote{model="cub"}} and specifying a shelter choice with the
\sphinxstyleemphasis{kwarg} \sphinxcode{\sphinxupquote{sh}}. CUSH2 models are automatically
implemented using \sphinxcode{\sphinxupquote{model="cush"}} and passing a list of two categories to
the \sphinxstyleemphasis{kwarg} \sphinxcode{\sphinxupquote{sh}} instead of an integer, for instance \sphinxcode{\sphinxupquote{sh={[}2, 7{]}}}.

\sphinxAtStartPar
To the \sphinxcode{\sphinxupquote{draw}} method, the parameters’ values (with the \sphinxstyleemphasis{kwargs} of the corresponding
family) must be passed:
for example, \sphinxcode{\sphinxupquote{pi}} and \sphinxcode{\sphinxupquote{xi}} for CUB models without covariates, \sphinxcode{\sphinxupquote{beta}} and \sphinxcode{\sphinxupquote{gamma}}
for CUB models with covariates for both feeling and uncertainty, etc. See the
\sphinxcode{\sphinxupquote{.draw()}} function reference of the corresponding family module for details.

\sphinxAtStartPar
If  \sphinxcode{\sphinxupquote{model="cub"}} (or nothing), then a CUB mixture model is fitted to the data to explain uncertainty,
feeling (\sphinxcode{\sphinxupquote{ordinal\textasciitilde{}Y|W}}) and possible shelter effect by further passing the extra argument \sphinxcode{\sphinxupquote{sh}} for the corresponding category.
Subjects’ covariates can be included by specifying covariates matrices in the
formula as \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}Y|W|X}},  to explain uncertainty (Y), feeling (W) or shelter (X).
Notice that
covariates for the shelter effect can be included only if specified for both feeling and uncertainty too (GeCUB models)
because, as in the R package \sphinxcode{\sphinxupquote{CUB}}, only the models without covariates and with covariates for all components
have been implemented.
Nevertheless, the symbol \sphinxcode{\sphinxupquote{1}} could be used to specify a different combination of components with covariates.
For example, if we want to specify a CUB model with covariate \sphinxcode{\sphinxupquote{cov}} for uncertainty only, we could pass the
formula \sphinxcode{\sphinxupquote{ordinal \textasciitilde{} cov | 1 | 1}}: in this case, for feeling and shelter effect, the constant terms only
(\(\gamma_0\) and \(\omega_0\)) will be estimated and the values of the estimated \(\xi\) and
\(\delta\) could be computed as \(\hat\xi=\mathrm{expit}(\hat\gamma_0)\) and
\(\hat\delta=\mathrm{expit}(\hat\omega_0)\), where \(\mathrm{expit}(x) = 1 / (1 + \exp(-x))\).
See {\hyperref[\detokenize{manual:cubsh-with-covariates}]{\sphinxsamedocref{this example}}} for the GeCUB model.

\sphinxAtStartPar
If \sphinxcode{\sphinxupquote{family="cube"}}, then a CUBE mixture model (Combination of Uniform and Beta\sphinxhyphen{}Binomial) is fitted to the data
to explain uncertainty, feeling and overdispersion.   Subjects’ covariates can be also included to explain the
feeling component or all the three components by  specifying covariates matrices in the Formula as
\sphinxcode{\sphinxupquote{ordinal\textasciitilde{}Y|W|Z}} to explain uncertainty (Y), feeling (W) or
overdispersion (Z). For different combinations of components with covariates, the symbol \sphinxcode{\sphinxupquote{1}} can be used.
Notice that \(\hat\phi=e^{\hat\alpha_0}\).

\sphinxAtStartPar
If \sphinxcode{\sphinxupquote{family="ihg"}}, then an IHG model is fitted to the data. IHG models (Inverse HyperGeometric) are a peculiar case of
CUBE models, for \(\phi = 1 - \xi\) (\hyperlink{cite.references:id15}{Iannario, 2012}). The parameter \(\theta\) gives the probability of observing
the first category and is therefore a direct measure of preference, attraction, pleasantness toward the
investigated item. This is the reason why \(\theta\) is customarily referred to as the
preference parameter of the
IHG model. Covariates for the preference parameter \(\theta\) have to be specified
in matrix form in the Formula as \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}V}}.

\sphinxAtStartPar
If \sphinxcode{\sphinxupquote{family="cush"}}, then a CUSH model is fitted to the data (Combination of Uniform and SHelter effect).
If a category corresponding to the inflation should be
passed via argument \sphinxcode{\sphinxupquote{sh}} a CUSH model is called and
covariates for the shelter parameter \(\delta\)
are specified in matrix form Formula as \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}X}}.
If two category corresponding to the inflation should be
passed via argument \sphinxcode{\sphinxupquote{sh}} (as a \sphinxstyleemphasis{list} or \sphinxstyleemphasis{array}) a CUSH2 model is called and
covariates for the shelters’ parameters \((\delta_1,\delta_2)\)
are specified in matrix form Formula as \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}X1|X2}}.
Notice that, to specify covariates for a
single shelter choice in a CUSH2 model,
the formula should be \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}X1|0}} and not \sphinxcode{\sphinxupquote{ordinal\textasciitilde{}0|X2}}.

\sphinxAtStartPar
Extra arguments include the maximum
number of iterations \sphinxcode{\sphinxupquote{maxiter}} for the optimization algorithm,
the required error tolerance \sphinxcode{\sphinxupquote{tol}}, and a dictionary of parameters of a known model
\sphinxcode{\sphinxupquote{ass\_pars}} (assumed parameters) to be compared with the estimates: these could be
the parameters used to draw the sample, theoretical parameters, or howsoever specified
parameters we want to (graphically) compare with the estimates.


\subsection{Methods of \sphinxstyleliteralintitle{\sphinxupquote{estimate}} and \sphinxstyleliteralintitle{\sphinxupquote{draw}}}
\label{\detokenize{manual:methods-of-estimate-and-draw}}
\sphinxAtStartPar
For both functions, the methods \sphinxcode{\sphinxupquote{.summary()}} and \sphinxcode{\sphinxupquote{.plot()}} are always available calling the
main functions to print a summary and plot the results, respectively. For \sphinxcode{\sphinxupquote{.plot()}} arguments
and options, see \sphinxhref{cubmods.html\#cubmods.smry.CUBsample}{here} the \sphinxcode{\sphinxupquote{CUBsample}} Class
(for object returned by \sphinxcode{\sphinxupquote{draw}})
and the extended \sphinxcode{\sphinxupquote{CUBres}} Classes of the corresponding
family (for objects returned by \sphinxcode{\sphinxupquote{estimate}}), defined in each family module.

\sphinxAtStartPar
Calling \sphinxcode{\sphinxupquote{.as\_dataframe()}} will return a DataFrame of parameters’ names and values for objects
of the Class \sphinxcode{\sphinxupquote{CUBsample}} returned by \sphinxcode{\sphinxupquote{draw}}. For objects of the extended Base Class \sphinxcode{\sphinxupquote{CUBres}} returned
by \sphinxcode{\sphinxupquote{estimate}} instead, will return a DataFrame with parameters’ component, name, estimated value,
standard error, Wald test statistics and p\sphinxhyphen{}value.

\sphinxAtStartPar
Calling the method \sphinxcode{\sphinxupquote{.save(fname)}} the object can be saved on a file called \sphinxcode{\sphinxupquote{fname.cub.sample}}
(for \sphinxcode{\sphinxupquote{draw}}) or \sphinxcode{\sphinxupquote{fname.cub.fit}} (for \sphinxcode{\sphinxupquote{estimate}}).
Saved objects can then be loaded using the function \sphinxcode{\sphinxupquote{general.load\_object(fname)}}.
See {\hyperref[\detokenize{manual:save-load-example}]{\sphinxsamedocref{this example}}}.


\subsection{Attributes of \sphinxstyleliteralintitle{\sphinxupquote{estimate}} and \sphinxstyleliteralintitle{\sphinxupquote{draw}}}
\label{\detokenize{manual:attributes-of-estimate-and-draw}}
\sphinxAtStartPar
For both objects returned by \sphinxcode{\sphinxupquote{estimate}} and \sphinxcode{\sphinxupquote{draw}}, the attributes \sphinxcode{\sphinxupquote{.formula}} and
\sphinxcode{\sphinxupquote{.df}} are always available. The function \sphinxcode{\sphinxupquote{draw}} will return the original DataFrame (if provided)
with an extra column of the drawn ordinal response called as specified in the formula.

\sphinxAtStartPar
Many other attributes can be called from objects of the Base Class \sphinxcode{\sphinxupquote{CUBres}} returned by
\sphinxcode{\sphinxupquote{estimate}}, such as the computed loglikelihood, the AIC and BIC, ectcetera. For details,
see \sphinxhref{cubmods.html\#cubmods.smry.CUBres}{here} the Base Class \sphinxcode{\sphinxupquote{CUBres}} reference guide.


\section{CUB family}
\label{\detokenize{manual:cub-family}}
\sphinxAtStartPar
Basic family of the class CUB. See the references for details:
\hyperlink{cite.references:id4}{Piccolo, 2003}; \hyperlink{cite.references:id5}{D\textquotesingle{}Elia and Piccolo, 2005}; \hyperlink{cite.references:id7}{Piccolo, 2006};
\hyperlink{cite.references:id8}{Iannario and Piccolo, 2010}; \hyperlink{cite.references:id20}{Iannario and Piccolo, 2009}; \hyperlink{cite.references:id21}{Iannario \sphinxstyleemphasis{et al.}, 2014};
\hyperlink{cite.references:id22}{Iannario \sphinxstyleemphasis{et al.}, 2022}; \hyperlink{cite.references:id3}{Piccolo and Simone, 2019}.


\subsection{Without covariates}
\label{\detokenize{manual:without-covariates}}\label{\detokenize{manual:cub-without-covariates}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cub00-module}{Reference guide}

\sphinxAtStartPar
A model of the CUB family for responses with \(m\) ordinal categories, without covariates is specified as
\begin{equation*}
\begin{split}\Pr(R=r|\boldsymbol{\theta}) = \pi \dbinom{m-1}{r-1}(1-\xi)^{r-1}\xi^{m-r}+\dfrac{1-\pi}{m},
\; r = 1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
where \(\pi\) and \(\xi\) are the parameters for respectively the \sphinxstyleemphasis{uncertainty} and the
\sphinxstyleemphasis{feeling} components.

\sphinxAtStartPar
Note that \((1-\pi)\) is the weight of the Uncertainty component and
\((1-\xi)\) is the Feeling component for common \sphinxstyleemphasis{positive wording}.

\sphinxAtStartPar
In the following example, a sample will be drawn from a CUB model of \(n=500\) observations of an ordinal
variable with \(m=10\) ordinal categories
and parameters \((\pi=.7, \xi=.2)\). A \sphinxcode{\sphinxupquote{seed=1}} will be set to ensure reproducibility.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id38}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0 | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{pi}\PYG{o}{=}\PYG{l+m+mf}{.7}\PYG{p}{,} \PYG{n}{xi}\PYG{o}{=}\PYG{l+m+mf}{.2}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of the drawn sample}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of the drawn sample}
\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUB model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== Drawn random sample
=======================================================================
m=10  Sample size=500  seed=1
formula: ord\PYGZti{}0|0
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
  component parameter  value
Uncertainty        pi    0.7
    Feeling        xi    0.2
=======================================================================
Sample metrics
Mean     = 7.368000
Variance = 5.687952
Std.Dev. = 2.384943
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Dissimilarity = 0.0650938
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cub00draw}.png}

\sphinxAtStartPar
Notice that, since the default value of the \sphinxstyleemphasis{kwarg} \sphinxcode{\sphinxupquote{model}} is
\sphinxcode{\sphinxupquote{"cub"}} we do not need to specify it.

\sphinxAtStartPar
Calling \sphinxcode{\sphinxupquote{drawn.as\_dataframe()}} will return a DataFrame with
the parameters

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     component parameter  value
0  Uncertainty        pi    0.7
1      Feeling        xi    0.2
\end{sphinxVerbatim}

\sphinxAtStartPar
Using the previously drawn sample, in the next example the parameters \((\hat\pi, \hat\xi)\) will be estimated.

\sphinxAtStartPar
Note that in the function \sphinxcode{\sphinxupquote{gem.estimate}}:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{df}} needs to be a \sphinxcode{\sphinxupquote{pandas}} DataFrame; the attribute \sphinxcode{\sphinxupquote{drawn.df}} will return a DataFrame with \sphinxcode{\sphinxupquote{ord}} as column name of the drawn ordinal response (as previuosly speficied in the formula)

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{formula}} needs the ordinal variable name (\sphinxcode{\sphinxupquote{ord}} in this case) and the covariates for each component (none in this case, so \sphinxcode{\sphinxupquote{"0|0"}})

\item {} 
\sphinxAtStartPar
if \sphinxcode{\sphinxupquote{m}} is not provided, the maximum observed ordinal value will be assumed and a warning will be raised

\item {} 
\sphinxAtStartPar
with \sphinxcode{\sphinxupquote{ass\_pars}} dictionary, the parameters of a known model (if any) can be specified; in this case, we’ll specify the known parameters used to draw the sample

\end{itemize}
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id39}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord\PYGZti{}0|0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{xi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUB model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=10  Size=500  Iterations=13  Maxiter=500  Tol=1E\PYGZhy{}04
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
    Estimates  StdErr    Wald  p\PYGZhy{}value
pi      0.675  0.0340  19.872   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
    Estimates  StdErr    Wald  p\PYGZhy{}value
xi      0.188  0.0090  20.808   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Correlation   = 0.2105
=======================================================================
Dissimilarity = 0.0599
Loglik(sat)   = \PYGZhy{}994.063
Loglik(MOD)   = \PYGZhy{}1000.111
Loglik(uni)   = \PYGZhy{}1151.293
Mean\PYGZhy{}loglik   = \PYGZhy{}2.000
Deviance      = 12.096
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 2004.22
BIC = 2012.65
=======================================================================
Elapsed time=0.00202 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Thu Sep 26 18:00:53 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cub00mle}.png}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\sphinxAtStartPar
Calling \sphinxcode{\sphinxupquote{fit.as\_dataframe()}} will return a DataFrame with
parameters’ estimated values and standard errors

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     component parameter  estimate    stderr       wald        pvalue
0  Uncertainty        pi   0.67476  0.033954  19.872485  7.042905e\PYGZhy{}88
1      Feeling        xi   0.18817  0.009043  20.807551  3.697579e\PYGZhy{}96
\end{sphinxVerbatim}
\phantomsection\label{\detokenize{manual:save-load-example}}
\sphinxAtStartPar
As an example, we can now save the \sphinxcode{\sphinxupquote{fit}} object to file. By default,
it will be saved as a \sphinxcode{\sphinxupquote{pickle}} file.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id40}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{fname}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cub\PYGZus{}mle\PYGZus{}results}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
The previous code, will save a file \sphinxcode{\sphinxupquote{cub\_mle\_results.cub.fit}}.

\sphinxAtStartPar
We can then load the saved file with the code
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id41}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{load\PYGZus{}object}

\PYG{n}{myfit} \PYG{o}{=} \PYG{n}{load\PYGZus{}object}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cub\PYGZus{}mle\PYGZus{}results.cub.fit}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
and we can apply to \sphinxcode{\sphinxupquote{myfit}} the same methods and attributes of the original \sphinxcode{\sphinxupquote{fit}} object.


\subsection{With covariates}
\label{\detokenize{manual:with-covariates}}\label{\detokenize{manual:cub-with-covariates}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cub0w-module}{Reference guide (0|W)}

\sphinxAtStartPar
\sphinxhref{cubmods.html\#cuby0-module}{Reference guide (Y|0)}

\sphinxAtStartPar
\sphinxhref{cubmods.html\#cubyw-module}{Reference guide (Y|W)}
\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb\theta, \pmb y_i, \pmb w_i) = \pi_i \dbinom{m-1}{r-1}(1-\xi_i)^{r-1}\xi_i^{m-r}+\dfrac{1-\pi_i}{m}
,\; r = 1,2,\ldots,m\end{split}
\end{equation*}\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \pi_i = \dfrac{1}{1+\exp\{-\pmb y_i \pmb \beta\}}
    \\
    \xi_i = \dfrac{1}{1+\exp\{-\pmb w_i \pmb \gamma\}}
\end{array}
\right.
\quad \equiv \quad
\left\{
\begin{array}{l}
    \mathrm{logit}(1-\pi_i) = - \pmb y_i \pmb \beta
    \vphantom{\dfrac{1}{1+\exp\{-\pmb y_i \pmb \beta\}}}
    \\
    \mathrm{logit}(1-\xi_i) = - \pmb w_i \pmb \gamma
    \vphantom{\dfrac{1}{1+\exp\{-\pmb w_i \pmb \gamma\}}}
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
All three combinations of covariates has been implemented for CUB family in both Python and R:
for \sphinxstyleemphasis{uncertainty} only, for \sphinxstyleemphasis{feeling} only, and for \sphinxstyleemphasis{both}.

\sphinxAtStartPar
Here we’ll show an example with covariates for \sphinxstyleemphasis{feeling} only.

\sphinxAtStartPar
First of all, we’ll draw a random sample with two covariates for the \sphinxstyleemphasis{feeling} component:
\sphinxcode{\sphinxupquote{W1}} and \sphinxcode{\sphinxupquote{W2}}. Note that, having two covariates, we’ll need three \(\gamma\) parameters,
to consider the constant term too.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id42}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{W1} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{n}{W2} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{random}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{W1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{W1}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{W2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{W2}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{response \PYGZti{} 0 | W1 + W2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{o}{=}\PYG{n}{n}\PYG{p}{,}
    \PYG{n}{pi}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}
    \PYG{n}{gamma}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mf}{2.3}\PYG{p}{,} \PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUB(0W) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== Drawn random sample
=======================================================================
m=10  Sample size=1000  seed=None
formula: res\PYGZti{}0|W1+W2
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
  component parameter  value
Uncertainty        pi    0.8
    Feeling  constant    2.3
    Feeling        W1    0.2
    Feeling        W2   \PYGZhy{}5.0
=======================================================================
Sample metrics
Mean     = 4.566000
Variance = 8.089734
Std.Dev. = 2.844246
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Dissimilarity = 0.0307673
=======================================================================
\end{sphinxVerbatim}
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id43}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} plot the drawn sample}
\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cub0wdraw}.png}
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id44}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} print the parameters\PYGZsq{} values}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{as\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     component parameter  value
0  Uncertainty        pi    0.8
1      Feeling  constant    2.3
2      Feeling        W1    0.2
3      Feeling        W2   \PYGZhy{}5.0
\end{sphinxVerbatim}
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id45}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} print the updated DataFrame}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     W1        W2  res
0     6  0.374540    2
1     9  0.950714    7
2     6  0.731994    8
3     1  0.598658    8
4     1  0.156019    4
..   ..       ...  ...
995   3  0.091582    2
996   9  0.917314    9
997   4  0.136819    1
998   7  0.950237    3
999   8  0.446006    2

[1000 rows x 3 columns]
\end{sphinxVerbatim}

\sphinxAtStartPar
Finally, we’ll call \sphinxcode{\sphinxupquote{estimate}} to estimate the parameters
given the observed (actually, drawn) sample.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id46}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{response \PYGZti{} 0 | W1+W2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUB(0W) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=10  Size=1000  Iterations=18  Maxiter=500  Tol=1E\PYGZhy{}04
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
          Estimates  StdErr     Wald  p\PYGZhy{}value
pi            0.800  0.0198   40.499   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant      2.353  0.1001   23.514   0.0000
W1            0.194  0.0138   14.034   0.0000
W2           \PYGZhy{}5.076  0.1454  \PYGZhy{}34.909   0.0000
=======================================================================
Dissimilarity = 0.0292
Loglik(MOD)   = \PYGZhy{}1807.052
Loglik(uni)   = \PYGZhy{}2302.585
Mean\PYGZhy{}loglik   = \PYGZhy{}1.807
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 3622.10
BIC = 3641.74
=======================================================================
Elapsed time=0.09656 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Thu Aug 15 18:31:21 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cub0wmle}.png}


\section{CUBSH family}
\label{\detokenize{manual:cubsh-family}}
\sphinxAtStartPar
Basic family of the class CUB with shelter effect.

\sphinxAtStartPar
See the references for details: \hyperlink{cite.references:id10}{Corduas \sphinxstyleemphasis{et al.}, 2009};
\hyperlink{cite.references:id9}{Iannario, 2012};
\hyperlink{cite.references:id3}{Piccolo and Simone, 2019}.


\subsection{Without covariates}
\label{\detokenize{manual:cubsh-without-covariates}}\label{\detokenize{manual:id13}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cubsh000-module}{Reference guide}

\sphinxAtStartPar
A model of the CUB family with shelter effect
for responses with \(m\) ordinal categories, without covariates is specified as
\begin{equation*}
\begin{split}\Pr(R=r|\boldsymbol{\theta}) = \delta D_r^{(c)} + (1-\delta)\left(\pi b_r(\xi) + \frac{1-\pi}{m} \right)
,\; r=1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
where \(\pi\) and \(\xi\) are the parameters for respectively the \sphinxstyleemphasis{uncertainty} and the
\sphinxstyleemphasis{feeling} components, and \(\delta\) is the weight of the shelter effect.

\sphinxAtStartPar
Other parametrizations have been proposed, such as
\begin{equation*}
\begin{split}\Pr(R=r|\boldsymbol{\theta}) = \lambda b_r(\xi) + (1-\lambda) \left[ \eta/m + (1-\eta) D_r^{(c)} \right]
,\; r=1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
where
\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \lambda = \pi(1-\delta)
    \\
    \eta = \dfrac{(1-\pi)(1-\delta)}{1 - \pi(1-\delta)}
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
See \hyperlink{cite.references:id3}{Piccolo and Simone, 2019} (pp 412\sphinxhyphen{}413) for the parameters’ interpretation.

\sphinxAtStartPar
Another parametrization, particularly useful for inferential issues is
\begin{equation*}
\begin{split}\Pr(R=r|\boldsymbol{\theta}) = \pi_1 b_r{\xi} + \pi_2 /m  + (1-\pi_1-\pi_2) D_r^{(c)}\end{split}
\end{equation*}
\sphinxAtStartPar
where
\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \pi_1 = (1-\delta)\pi
    \\
    \pi_2 = (1-\delta)(1-\pi)
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
See the references for further details.

\sphinxAtStartPar
In the next example, we’ll draw an ordinal response
and then estimate the parameters given the sample.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id47}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0 | 0 | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
    \PYG{n}{pi}\PYG{o}{=}\PYG{l+m+mf}{.8}\PYG{p}{,} \PYG{n}{xi}\PYG{o}{=}\PYG{l+m+mf}{.4}\PYG{p}{,} \PYG{n}{delta}\PYG{o}{=}\PYG{l+m+mf}{.15}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{1500}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{as\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     component parameter  value
0      Uniform       pi1   0.68
1     Binomial       pi2   0.17
2      Feeling        xi   0.40
3  Uncertainty       *pi   0.80
4      Shelter    *delta   0.15
\end{sphinxVerbatim}

\sphinxAtStartPar
Notice that:
\begin{itemize}
\item {} 
\sphinxAtStartPar
since \sphinxcode{\sphinxupquote{"cub"}} is default value of the \sphinxstyleemphasis{kwarg} \sphinxcode{\sphinxupquote{model}}, we do not need to specify it

\item {} 
\sphinxAtStartPar
we’ll pass to \sphinxcode{\sphinxupquote{estimate}} \sphinxstyleemphasis{kwarg} values taken from the object \sphinxcode{\sphinxupquote{drawn}}

\end{itemize}
\phantomsection\label{\detokenize{manual:confidence-ellipsoid}}
\sphinxAtStartPar
The method \sphinxcode{\sphinxupquote{.plot()}} (of the \sphinxcode{\sphinxupquote{fit}} object)
shows, in the parameters space, the trivariate confidence ellipsoid too, which has not
been implemented yet in the \sphinxcode{\sphinxupquote{CUB}} package in R.
The plot includes the marginal bivariate confidence ellipses too. Notice that, as proven in
\hyperlink{cite.references:id41}{Pierini, 2024} pp 28\sphinxhyphen{}30, the confidence level of the marginal ellipses is greater
than the ellipsoid’s confidence level. Indeed, the radius \(r\) of a
standardized sphere at confidence
level \((1-\alpha_3)\) is equal to \(r = \sqrt{ F^{-1}_{\chi^2_{(3)}}(1-\alpha_3) }\), thus
the confidence level of the bivariate marginal ellipses (which is a section of a trivariate
cylinder) is \((1-\alpha_2) = F_{\chi^2_{(2)}(r^2)}\).
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id48}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{sh}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{formula}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pi1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pi2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{xi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUBSH model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=7  Shelter=1  Size=1500  Iterations=59  Maxiter=500  Tol=1E\PYGZhy{}04
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Alternative parametrization
       Estimates  StdErr    Wald  p\PYGZhy{}value
pi1        0.661  0.0307  21.508   0.0000
pi2        0.174  0.0344   5.041   0.0000
xi         0.388  0.0077  50.592   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
       Estimates  StdErr    Wald  p\PYGZhy{}value
pi         0.792  0.0400  19.813   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
       Estimates  StdErr    Wald  p\PYGZhy{}value
xi         0.388  0.0077  50.592   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect
       Estimates  StdErr    Wald  p\PYGZhy{}value
delta      0.166  0.0116  14.327   0.0000
=======================================================================
Dissimilarity = 0.0049
Loglik(sat)   = \PYGZhy{}2734.302
Loglik(MOD)   = \PYGZhy{}2734.433
Loglik(uni)   = \PYGZhy{}2918.865
Mean\PYGZhy{}loglik   = \PYGZhy{}1.823
Deviance      = 0.263
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 5474.87
BIC = 5490.81
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cubsh00mle}.png}


\subsection{With covariates}
\label{\detokenize{manual:cubsh-with-covariates}}\label{\detokenize{manual:id16}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cubshywx-module}{Reference guide}
\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb\theta, \pmb y_i, \pmb w_i, \pmb x_i) = \delta_i D_r^{(c)} + (1-\delta_i)\left(\pi_i b_r(\xi_i) + \frac{1-\pi_i}{m} \right)
,\; r=1,2,\ldots,m\end{split}
\end{equation*}\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \pi_i = \dfrac{1}{1+\exp\{-\pmb y_i \pmb \beta\}}
    \\
    \xi_i = \dfrac{1}{1+\exp\{-\pmb w_i \pmb \gamma\}}
    \\
    \delta_i = \dfrac{1}{1+\exp\{-\pmb x_i \pmb \omega\}}
\end{array}
\right.
\quad \equiv \quad
\left\{
\begin{array}{l}
    \mathrm{logit}(1-\pi_i) = -\pmb y_i \pmb \beta
    \vphantom{\dfrac{1}{1+\exp\{-\pmb y_i \pmb \beta\}}}
    \\
    \mathrm{logit}(1-\xi_i) = -\pmb w_i \pmb \gamma
    \vphantom{\dfrac{1}{1+\exp\{-\pmb w_i \pmb \gamma\}}}
    \\
    \mathrm{logit}(\delta_i) = \pmb x_i \pmb \omega
    \vphantom{\dfrac{1}{1+\exp\{-\pmb x_i \pmb \omega\}}}
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
Only the model with covariates for all components has been
currently defined and implemented, as in the R package \sphinxcode{\sphinxupquote{CUB}}.

\sphinxAtStartPar
Nevertheless, thanks to the symbol \sphinxcode{\sphinxupquote{1}} provided by the
\sphinxstyleemphasis{formula}, we can specify a different combination
of covariates.

\sphinxAtStartPar
For example, we’ll specifiy a model CUB with shelter effect,
with covariates for uncertainty only. We’ll use the function
\sphinxcode{\sphinxupquote{logit}} to have better ‘control’ of the parameters values,
because \(\gamma_0 = \mathrm{logit}(\xi)\) and
similarly for \(\pi\) and \(\delta\).
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id49}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{expit}\PYG{p}{,} \PYG{n}{logit}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{W1} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{W1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{W1}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} W1 | 1 | 1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,}
    \PYG{n}{beta}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.8}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{.2}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{gamma}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.3}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{omega}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.12}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} W1 | 1 | 1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUBSH(YWX) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Shelter=2  Size=1000  Iterations=25  Maxiter=500  Tol=1E\PYGZhy{}04
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant      0.992  0.3314    2.994   0.0028
W1           \PYGZhy{}0.127  0.0569   \PYGZhy{}2.228   0.0259
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}0.902  0.0381  \PYGZhy{}23.662   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}2.074  0.1260  \PYGZhy{}16.462   0.0000
=======================================================================
Dissimilarity = 0.0139
Loglik(MOD)   = \PYGZhy{}2069.978
Loglik(uni)   = \PYGZhy{}2197.225
Mean\PYGZhy{}loglik   = \PYGZhy{}2.070
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 4147.96
BIC = 4167.59
=======================================================================
Elapsed time=1.43850 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Thu Aug 15 19:39:49 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cubshywxmle}.png}

\sphinxAtStartPar
To get the estimated values of \(\hat\xi\) and \(\hat\delta\)
we can use the function \sphinxcode{\sphinxupquote{expit}} because \(\hat\xi = \mathrm{expit}(\hat\gamma_0)\)
and similarly for \(\hat\delta\). Then, we can use the delta\sphinxhyphen{}method
to compute the standard errors of both \(\hat\xi\) and \(\hat\delta\), for instance
\(\widehat{es}(\xi) = \mathrm{expit}[\hat\gamma_0+\widehat{es}(\gamma_0)] - \hat\xi\).
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id50}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{est\PYGZus{}xi} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{est\PYGZus{}de} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{est\PYGZus{}xi\PYGZus{}se} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{stderrs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{est\PYGZus{}xi}
\PYG{n}{est\PYGZus{}de\PYGZus{}se} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{+}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{stderrs}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{est\PYGZus{}de}
\PYG{n+nb}{print}\PYG{p}{(}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{     estimates  stderr}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{xi      }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}xi}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}xi\PYGZus{}se}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{delta   }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}de}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}de\PYGZus{}se}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     estimates  stderr
xi      0.2886  0.0079
delta   0.1116  0.0131
\end{sphinxVerbatim}

\sphinxAtStartPar
which, in fact, match the values used to draw the sample.


\section{CUSH family}
\label{\detokenize{manual:cush-family}}
\sphinxAtStartPar
Basic family of the class CUSH with a single shelter effect.

\sphinxAtStartPar
See the references for details: \hyperlink{cite.references:id11}{Capecchi and Piccolo, 2017}; \hyperlink{cite.references:id3}{Piccolo and Simone, 2019}.


\subsection{Without covariates}
\label{\detokenize{manual:cush-without-covariates}}\label{\detokenize{manual:id19}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cush0-module}{Reference guide}
\begin{equation*}
\begin{split}\Pr(R=r|\pmb\theta) = \delta D_r^{(c)} + (1-\delta)/m
,\; r=1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
In the example, we’ll draw a sample from a CUSH model without covariates and
then estimate the parameter given the observed sample.

\sphinxAtStartPar
Notice that, since the \sphinxcode{\sphinxupquote{model}} is not the default \sphinxcode{\sphinxupquote{"cub"}}, we need to specify it.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id51}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{n}{delta}\PYG{o}{=}\PYG{l+m+mf}{.15}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{1500}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{76}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord\PYGZti{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{delta}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUSH model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=7  Shelter=7  Size=1500
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect
       Estimates  StdErr   Wald  p\PYGZhy{}value
delta      0.124  0.0130  9.532   0.0000
=======================================================================
Dissimilarity = 0.0236
Loglik(sat)   = \PYGZhy{}2856.039
Loglik(MOD)   = \PYGZhy{}2859.923
Loglik(uni)   = \PYGZhy{}2918.865
Mean\PYGZhy{}loglik   = \PYGZhy{}1.907
Deviance      = 7.768
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 5721.85
BIC = 5727.16
=======================================================================
Elapsed time=0.00113 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 10:44:07 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cush0mle}.png}


\subsection{With covariates}
\label{\detokenize{manual:cush-with-covariates}}\label{\detokenize{manual:id20}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cushx-module}{Reference guide}
\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb\theta,\pmb x_i) = \delta_i D_r^{(c)} + (1-\delta_i)/m
,\; r=1,2,\ldots,m\end{split}
\end{equation*}\begin{equation*}
\begin{split}\delta_i = \dfrac{1}{1+\exp\{ - \pmb x_i \pmb\omega \}}
\quad \equiv \quad
\mathrm{logit}(\delta_i) = \pmb x_i \pmb\omega\end{split}
\end{equation*}
\sphinxAtStartPar
In the example, we’ll draw a sample from a CUSH model with covariates and
then estimate the parameter given the observed sample.

\sphinxAtStartPar
Notice that, since the \sphinxcode{\sphinxupquote{model}} is not the default \sphinxcode{\sphinxupquote{"cub"}}, we need to specify it.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id52}}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{logit}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{X} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{X}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} X}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
    \PYG{n}{omega}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.05}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{.2}\PYG{p}{]}\PYG{p}{,}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} X}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUSH(X) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Shelter=5  Size=1000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect
          Estimates  StdErr    Wald  p\PYGZhy{}value
constant     \PYGZhy{}3.131  0.4361  \PYGZhy{}7.180   0.0000
X             0.229  0.0629   3.642   0.0003
=======================================================================
Dissimilarity = 0.0395
Loglik(MOD)   = \PYGZhy{}2130.030
Loglik(uni)   = \PYGZhy{}2197.225
Mean\PYGZhy{}loglik   = \PYGZhy{}2.130
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 4264.06
BIC = 4273.87
=======================================================================
Elapsed time=0.01704 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 10:54:11 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cushxmle}.png}


\section{CUSH2 family}
\label{\detokenize{manual:cush2-family}}
\sphinxAtStartPar
Family of the class CUSH with two shelter effects (CUSH2).
See the references for details.

\sphinxAtStartPar
This family has been introduced by \hyperlink{cite.references:id41}{Pierini, 2024} (pp 16\sphinxhyphen{}20) and first
implemented in this Python package. See \hyperlink{cite.references:id3}{Piccolo and Simone, 2019} as a reference
for the CUB class models.

\sphinxAtStartPar
These models are particularly useful whenever the shelter choices are not
\sphinxstyleemphasis{polarized}, i.e. they’re not at the extremes of the ordinal variable support.
In these cases, finite mixtures of the Beta Discretized distribution can be
used (\hyperlink{cite.references:id12}{Simone, 2022}).


\subsection{Without covariates}
\label{\detokenize{manual:cush2-without-covariates}}\label{\detokenize{manual:id24}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cush200-module}{Reference guide}
\begin{equation*}
\begin{split}\Pr(R=r|\pmb\theta) = \delta_1 D_r^{(c_1)} + \delta_2 D_r^{(c_2)} + (1-\delta_1-\delta_2)/m
,\; r=1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
In the example, we’ll draw a sample from a CUSH2 model without covariates and
then estimate the parameter given the observed sample.

\sphinxAtStartPar
Notice that, since the \sphinxcode{\sphinxupquote{model}} is not the default \sphinxcode{\sphinxupquote{"cub"}}, we need to specify it.
Passing a list of two shelter categories with the \sphinxstyleemphasis{kwarg} \sphinxcode{\sphinxupquote{sh}}, a CUSH2 model will be
called.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id53}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0 | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{sh}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{,}
    \PYG{n}{delta1}\PYG{o}{=}\PYG{l+m+mf}{.15}\PYG{p}{,} \PYG{n}{delta2}\PYG{o}{=}\PYG{l+m+mf}{.1}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord\PYGZti{}0|0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{sh}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{delta1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{delta2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUSH2 model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=7  Shelter=[1 7]  Size=1000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effects
        Estimates  StdErr    Wald  p\PYGZhy{}value
delta1      0.171  0.0148  11.535   0.0000
delta2      0.107  0.0163   6.555   0.0000
=======================================================================
Dissimilarity = 0.0184
Loglik(sat)   = \PYGZhy{}1852.818
Loglik(MOD)   = \PYGZhy{}1854.344
Loglik(uni)   = \PYGZhy{}1945.910
Mean\PYGZhy{}loglik   = \PYGZhy{}1.854
Deviance      = 3.053
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 3712.69
BIC = 3722.50
=======================================================================
Elapsed time=0.00228 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 11:15:21 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cush200mle}.png}


\subsection{With covariates}
\label{\detokenize{manual:cush2-with-covariates}}\label{\detokenize{manual:id25}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cush2x0-module}{Reference guide (X1|0)}

\sphinxAtStartPar
\sphinxhref{cubmods.html\#cush2xx-module}{Reference guide (X1|X2)}
\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb\theta,\pmb x_{1i}, \pmb x_{2i}) = \delta_{1i} D_r^{(c_1)} + \delta_{2i} D_r^{(c_2)} + (1-\delta_{1i}- \delta_{2i})/m
,\; r=1,2,\ldots,m\end{split}
\end{equation*}\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \delta_{1i} = \dfrac{1}{1+\exp\{ - \pmb x_{1i} \pmb\omega_1 \}}
    \\
    \delta_{2i} = \dfrac{1}{1+\exp\{ - \pmb x_{2i} \pmb\omega_2 \}}
\end{array}
\right.
\quad \equiv \quad
\left\{
\begin{array}{l}
    \mathrm{logit}(\delta_{1i}) = \pmb x_{1i} \pmb\omega_1
    \vphantom{\dfrac{1}{1+\exp\{ - \pmb x_{1i} \pmb\omega_1 \}}}
    \\
    \mathrm{logit}(\delta_{2i}) = \pmb x_{2i} \pmb\omega_2
    \vphantom{\dfrac{1}{1+\exp\{ - \pmb x_{2i} \pmb\omega_2 \}}}
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
Two CUSH2 models with covariates have been defined and implemented:
for the first shelter choice only and for both.

\sphinxAtStartPar
In this example we’ll draw a sample from a CUSH2 model with
covariates for the first shelter choice only and will then
estimate the parameters with a CUSH2 model with covariates
for both shelter choices but using the symbol \sphinxcode{\sphinxupquote{1}} in the
formula for the second shelter choice to estimate the
constant parameter only. This is usually not needed, but
we do it here to confirm that \(\mathrm{expit}(\hat\omega_{20})=\hat\delta_2\).

\sphinxAtStartPar
Notice that, since the \sphinxcode{\sphinxupquote{model}} is not the default \sphinxcode{\sphinxupquote{"cub"}}, we need to specify it.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id54}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{logit}\PYG{p}{,} \PYG{n}{expit}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{X} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{X}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} X | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{omega1}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.05}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{.2}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{delta2}\PYG{o}{=}\PYG{l+m+mf}{.1}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} X | 1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cush}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,} \PYG{n}{sh}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{]}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{est\PYGZus{}de2} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{est\PYGZus{}de2\PYGZus{}es} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{stderrs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{est\PYGZus{}de2}
\PYG{n+nb}{print}\PYG{p}{(}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{     estimates  stderr}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{delta2  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}de2}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}de2\PYGZus{}es}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUSH2(X1,X2) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Shelter=[2 8]  Size=1000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect 1
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}3.170  0.4216   \PYGZhy{}7.519   0.0000
X             0.207  0.0613    3.379   0.0007
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Shelter effect 2
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}2.276  0.1609  \PYGZhy{}14.149   0.0000
=======================================================================
Dissimilarity = 0.0305
Loglik(MOD)   = \PYGZhy{}2122.463
Loglik(uni)   = \PYGZhy{}2197.225
Mean\PYGZhy{}loglik   = \PYGZhy{}2.122
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 4250.93
BIC = 4265.65
=======================================================================
Elapsed time=0.06553 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 11:29:11 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cush2xxmle}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     estimates  stderr
delta2  0.0931  0.0145
\end{sphinxVerbatim}


\section{CUBE family}
\label{\detokenize{manual:cube-family}}
\sphinxAtStartPar
Family of the class CUBE (Combination of Uniform and BEtaBinomial).
CUB models are nested into CUBE models: in fact, a CUB model is equal to
a CUBE model with the overdispersion parameter \(\phi=0\).
Notiche that \(0\geq\phi\geq0.2\) is the usual range of the overdispersion parameter.

\sphinxAtStartPar
See the references for details: \hyperlink{cite.references:id16}{Iannario, 2014}; \hyperlink{cite.references:id14}{Piccolo, 2015};
\hyperlink{cite.references:id3}{Piccolo and Simone, 2019}.


\subsection{Without covariates}
\label{\detokenize{manual:cube-without-covariates}}\label{\detokenize{manual:id29}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cube000-module}{Reference guide}
\begin{equation*}
\begin{split}\Pr(R=r|\pmb{\theta}) = \pi \beta e(\xi,\phi)+\dfrac{1-\pi}{m},
,\; r=1,2,\ldots,m\end{split}
\end{equation*}
\sphinxAtStartPar
In this example, we’ll draw a sample from a CUBE model and then
will estimate the parameters given the observed sample.

\sphinxAtStartPar
Notice that, since the \sphinxcode{\sphinxupquote{model}} is not the default \sphinxcode{\sphinxupquote{"cub"}}, we need to specify it.

\sphinxAtStartPar
The \sphinxtitleref{.plot()} method of the object \sphinxtitleref{fit} will show trivariate and bivariate confidence
regions too, as in CUBSH models. See {\hyperref[\detokenize{manual:confidence-ellipsoid}]{\sphinxsamedocref{here}}} for the values of confidence levels.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id55}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0 | 0 | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{pi}\PYG{o}{=}\PYG{l+m+mf}{.7}\PYG{p}{,} \PYG{n}{xi}\PYG{o}{=}\PYG{l+m+mf}{.3}\PYG{p}{,} \PYG{n}{phi}\PYG{o}{=}\PYG{l+m+mf}{.15}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord\PYGZti{}0|0|0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{xi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{phi}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUBE model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Size=500  Iterations=62  Maxiter=1000  Tol=1E\PYGZhy{}06
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
     Estimates  StdErr    Wald  p\PYGZhy{}value
pi       0.577  0.0633   9.108   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
     Estimates  StdErr    Wald  p\PYGZhy{}value
xi       0.251  0.0217  11.560   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Overdispersion
     Estimates  StdErr    Wald  p\PYGZhy{}value
phi      0.111  0.0402   2.754   0.0059
=======================================================================
Dissimilarity = 0.0426
Loglik(sat)   = \PYGZhy{}1037.855
Loglik(MOD)   = \PYGZhy{}1041.100
Loglik(uni)   = \PYGZhy{}1098.612
Mean\PYGZhy{}loglik   = \PYGZhy{}2.082
Deviance      = 6.491
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 2088.20
BIC = 2100.84
=======================================================================
Elapsed time=0.07919 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 12:18:49 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cube000mle}.png}


\subsection{With covariates}
\label{\detokenize{manual:cube-with-covariates}}\label{\detokenize{manual:id30}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#cube0w0-module}{Reference guide (0|W|0)}

\sphinxAtStartPar
\sphinxhref{cubmods.html\#cubeywz-module}{Reference guide (Y|W|Z)}
\begin{equation*}
\begin{split}\Pr(R_i=r|\pmb{\theta};\pmb y_i, \pmb w_i; \pmb z_i) = \pi_i \beta e(\xi_i,\phi_i)+\dfrac{1-\pi_i}{m},
,\; r=1,2,\ldots,m\end{split}
\end{equation*}\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \pi_i = \dfrac{1}{1+\exp\{ -\pmb y_i \pmb\beta\}}
    \\
    \xi_i = \dfrac{1}{1+\exp\{ -\pmb w_i \pmb\gamma\}}
    \\
    \phi_i = \exp\{ \pmb z_i \pmb \alpha \}
\end{array}
\right.
\quad \equiv \quad
\left\{
\begin{array}{l}
    \mathrm{logit}(1-\pi_i) = -\pmb y_i \pmb\beta
    \vphantom{\dfrac{1}{1+\exp\{ -\pmb y_i \pmb\beta\}}}
    \\
    \mathrm{logit}(1-\xi_i) = -\pmb w_i \pmb\gamma
    \vphantom{\dfrac{1}{1+\exp\{ -\pmb w_i \pmb\gamma\}}}
    \\
    \log \phi_i = \pmb z_i \pmb \alpha
    \vphantom{\exp\{ \pmb z_i \pmb \alpha \}}
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
Currently, as in the R package \sphinxcode{\sphinxupquote{CUB}}, two CUBE models with covariates have been defined and implemented:
for the \sphinxstyleemphasis{feeling} only and for all components.
Nevertheless, the symbol \sphinxcode{\sphinxupquote{1}} can always be used in the
formula for different combinations of covariates.

\sphinxAtStartPar
In this example, we’ll draw a sample with covariates for
\sphinxstyleemphasis{feeling} only and then will estimate the parameters given
the observed sample.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id56}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{expit}\PYG{p}{,} \PYG{n}{logit}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{76}\PYG{p}{)}
\PYG{n}{W} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{W}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{W}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} 0 | W | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,}
    \PYG{n}{pi}\PYG{o}{=}\PYG{l+m+mf}{.8}\PYG{p}{,}
    \PYG{n}{gamma}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.3}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{.1}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{phi}\PYG{o}{=}\PYG{l+m+mf}{.12}\PYG{p}{,}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} 0 | W | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUBE(0W0) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Size=1000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
          Estimates  StdErr    Wald  p\PYGZhy{}value
pi            0.815  0.0343  23.733   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
          Estimates  StdErr    Wald  p\PYGZhy{}value
constant     \PYGZhy{}0.770  0.1012  \PYGZhy{}7.612   0.0000
W            \PYGZhy{}0.116  0.0191  \PYGZhy{}6.052   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Overdisperson
          Estimates  StdErr    Wald  p\PYGZhy{}value
phi           0.150  0.0260   5.779   0.0000
=======================================================================
Dissimilarity = 0.0183
Loglik(MOD)   = \PYGZhy{}1886.654
Loglik(uni)   = \PYGZhy{}2197.225
Mean\PYGZhy{}loglik   = \PYGZhy{}1.887
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 3781.31
BIC = 3800.94
=======================================================================
Elapsed time=2.30903 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 12:31:10 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cube0w0mle}.png}

\sphinxAtStartPar
Notice that the same results can be achieved using a CUBE
model with covariates for all components and passing
the symbol \sphinxcode{\sphinxupquote{1}} to the \sphinxstyleemphasis{uncertainty} and \sphinxstyleemphasis{overdispersion}
components.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id57}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} MLE estimation}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{fee \PYGZti{} 1 | W | 1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Print MLE summary}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot the results}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} CUBE(YWZ) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=9  Size=1000  Iterations=29  Maxiter=1000  Tol=1E\PYGZhy{}02
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Uncertainty
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant      1.423  0.2183    6.518   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Feeling
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}0.778  0.1018   \PYGZhy{}7.639   0.0000
W            \PYGZhy{}0.117  0.0193   \PYGZhy{}6.074   0.0000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Overdispersion
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}1.930  0.1756  \PYGZhy{}10.989   0.0000
=======================================================================
Dissimilarity = 0.0239
Loglik(MOD)   = \PYGZhy{}1886.690
Loglik(uni)   = \PYGZhy{}2197.225
Mean\PYGZhy{}loglik   = \PYGZhy{}1.887
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 3781.38
BIC = 3801.01
=======================================================================
Elapsed time=50.02969 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 12:33:36 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{cubeywzmle}.png}

\sphinxAtStartPar
In fact:
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id58}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{n}{est\PYGZus{}pi} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{est\PYGZus{}ph} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{exp}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{est\PYGZus{}pi\PYGZus{}se} \PYG{o}{=} \PYG{n}{expit}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{+}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{stderrs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{est\PYGZus{}pi}
\PYG{n}{est\PYGZus{}ph\PYGZus{}se} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{exp}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{estimates}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{+}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{stderrs}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{est\PYGZus{}ph}
\PYG{n+nb}{print}\PYG{p}{(}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{     estimates  stderr}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pi      }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}pi}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}pi\PYGZus{}se}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{phi     }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}ph}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{  }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{est\PYGZus{}ph\PYGZus{}se}\PYG{l+s+si}{:}\PYG{l+s+s2}{.4f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
     estimates  stderr
pi      0.8058  0.0319
phi     0.1451  0.0279
\end{sphinxVerbatim}


\section{IHG family}
\label{\detokenize{manual:ihg-family}}
\sphinxAtStartPar
Family of the class IHG (Inverse HyperGeometric).

\sphinxAtStartPar
See the references for details: \hyperlink{cite.references:id17}{D’Elia, 2003}; \hyperlink{cite.references:id18}{D\textquotesingle{}Elia \sphinxstyleemphasis{et al.}, 2005};
\hyperlink{cite.references:id3}{Piccolo and Simone, 2019}.


\subsection{Without covariates}
\label{\detokenize{manual:ihg-without-covariates}}\label{\detokenize{manual:id34}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#ihg0-module}{Reference guide}
\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \Pr(R=1|\theta) = \theta
    \\
    \Pr(R=r+1|\theta) = \Pr(R=r|\theta)(1-\theta)\dfrac{m-r}{m-1-r(1-\theta)},\; r= 1,2, \ldots, m-1
\end{array}
\right.\end{split}
\end{equation*}
\sphinxAtStartPar
which is equivalent to
\begin{equation*}
\begin{split}\begin{array}{l}
\Pr(R=r|\theta) = \frac{ \dbinom{m+B-r-1}{m-r} }{ \dbinom{m+B-1}{m-1} },\; r= 1,2, \ldots, m
\\
\textrm{with } B = (m-1)\theta / (1 - \theta)
\end{array}\end{split}
\end{equation*}
\sphinxAtStartPar
In this example, we’ll draw a sample from an IHG model
and the estimate the parameter from the observed sample.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ihg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{theta}\PYG{o}{=}\PYG{l+m+mf}{.2}\PYG{p}{,}
    \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ihg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{theta}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} IHG model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=10  Size=500
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Theta
       Estimates  StdErr    Wald  p\PYGZhy{}value
theta      0.200  0.0086  23.292   0.0000
=======================================================================
Dissimilarity = 0.0639
Loglik(sat)   = \PYGZhy{}1044.100
Loglik(MOD)   = \PYGZhy{}1050.513
Loglik(uni)   = \PYGZhy{}1151.293
Mean\PYGZhy{}loglik   = \PYGZhy{}2.101
Deviance      = 12.824
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 2103.03
BIC = 2107.24
=======================================================================
Elapsed time=0.00464 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 12:47:55 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ihg0mle}.png}


\subsection{With covariates}
\label{\detokenize{manual:ihg-with-covariates}}\label{\detokenize{manual:id35}}
\sphinxAtStartPar
\sphinxhref{cubmods.html\#ihgv-module}{Reference guide}
\begin{equation*}
\begin{split}\left\{
\begin{array}{l}
    \Pr(R_i=1|\pmb\theta;\pmb v_i) = \theta_i
    \\
    \Pr(R_i=r+1|\pmb\theta;\pmb v_i) = \Pr(R_i=r|\pmb\theta;\pmb v_i)(1-\theta_i)\dfrac{m-r}{m-1-r(1-\theta_i)},\; r= 1, \ldots, m-1
\end{array}
\right.\end{split}
\end{equation*}\begin{equation*}
\begin{split}\theta_i = \dfrac{1}{1 + \exp\{ - \pmb v_i \pmb \nu \}}
\quad \equiv \quad
\mathrm{logit}(\theta_i) = \pmb v_i \pmb \nu\end{split}
\end{equation*}
\sphinxAtStartPar
In this example we’ll draw a sample from an IHG with two covariates
and then will estimate the parameters given the observed sample.
Notice that IHG models without covariates are unimodals but, however,
IHG models with covariates can be bimodal, as the one in the following example.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id59}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} import libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}\PYG{p}{,} \PYG{n}{estimate}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{general} \PYG{k+kn}{import} \PYG{n}{logit}

\PYG{c+c1}{\PYGZsh{} Draw a random sample}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{1000}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{V1} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{random}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{n}{V2} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{random}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{V1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{V1}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{V2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{V2}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} draw a sample}
\PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} V1 + V2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ihg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,}
    \PYG{n}{nu}\PYG{o}{=}\PYG{p}{[}\PYG{n}{logit}\PYG{p}{(}\PYG{l+m+mf}{.1}\PYG{p}{)}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} inferential method on drawn sample}
\PYG{n}{fit} \PYG{o}{=} \PYG{n}{estimate}\PYG{p}{(}
    \PYG{n}{df}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{df}\PYG{p}{,}
    \PYG{n}{formula}\PYG{o}{=}\PYG{n}{drawn}\PYG{o}{.}\PYG{n}{formula}\PYG{p}{,}
    \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ihg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ass\PYGZus{}pars}\PYG{o}{=}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{theta}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{pars}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} print the summary of MLE}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{fit}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} show the plot of MLE}
\PYG{n}{fit}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
warnings.warn(\PYGZdq{}No m given, max(ordinal) has been taken\PYGZdq{})
=======================================================================
=====\PYGZgt{}\PYGZgt{}\PYGZgt{} IHG(V) model \PYGZlt{}\PYGZlt{}\PYGZlt{}===== ML\PYGZhy{}estimates
=======================================================================
m=10  Size=1000
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Theta
          Estimates  StdErr     Wald  p\PYGZhy{}value
constant     \PYGZhy{}2.368  0.0998  \PYGZhy{}23.741   0.0000
V1           \PYGZhy{}1.973  0.1438  \PYGZhy{}13.721   0.0000
V2            3.230  0.1451   22.261   0.0000
=======================================================================
Dissimilarity = 0.0455
Loglik(MOD)   = \PYGZhy{}1958.475
Loglik(uni)   = \PYGZhy{}2302.585
Mean\PYGZhy{}loglik   = \PYGZhy{}1.958
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
AIC = 3922.95
BIC = 3937.67
=======================================================================
Elapsed time=1.10664 seconds =====\PYGZgt{}\PYGZgt{}\PYGZgt{} Fri Aug 16 12:53:12 2024
=======================================================================
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{ihgvmle}.png}


\section{MULTICUB}
\label{\detokenize{manual:multicub}}\label{\detokenize{manual:multicub-manual}}
\sphinxAtStartPar
See the \hyperlink{cite.references:id3}{Piccolo and Simone, 2019} as a reference.

\sphinxAtStartPar
\sphinxhref{cubmods.html\#multicub-module}{Reference guide}

\sphinxAtStartPar
With the \sphinxstylestrong{multicub} tool, parameters estimated from
multiple observed samples can be shown in a single plot.

\sphinxAtStartPar
In this example, we’ll draw three samples from CUBE
models and \sphinxstyleemphasis{manually} add a shelter category. Then we’ll
use the \sphinxstylestrong{multicub} tool for CUB models, CUBE models and
CUBSH models (that aren’t yet implemented in the R package \sphinxcode{\sphinxupquote{CUB}}).

\sphinxAtStartPar
The \sphinxstylestrong{multicub} tool in \sphinxcode{\sphinxupquote{cubmods}} package can also show confidence
ellipses for CUB models.
\sphinxSetupCaptionForVerbatim{Script}
\def\sphinxLiteralBlockLabel{\label{\detokenize{manual:id60}}}
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{gem} \PYG{k+kn}{import} \PYG{n}{draw}
\PYG{k+kn}{from} \PYG{n+nn}{cubmods}\PYG{n+nn}{.}\PYG{n+nn}{multicub} \PYG{k+kn}{import} \PYG{n}{multi}

\PYG{c+c1}{\PYGZsh{} draw random samples}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{p}{(}\PYG{n}{pi}\PYG{p}{,} \PYG{n}{xi}\PYG{p}{,} \PYG{n}{phi}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}
    \PYG{n+nb}{zip}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{.9}\PYG{p}{,} \PYG{l+m+mf}{.8}\PYG{p}{,} \PYG{l+m+mf}{.7}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{.3}\PYG{p}{,} \PYG{l+m+mf}{.5}\PYG{p}{,} \PYG{l+m+mf}{.7}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{.05}\PYG{p}{,} \PYG{l+m+mf}{.1}\PYG{p}{,} \PYG{l+m+mf}{.15}\PYG{p}{]}\PYG{p}{)}
    \PYG{p}{)}\PYG{p}{:}
    \PYG{n}{drawn} \PYG{o}{=} \PYG{n}{draw}\PYG{p}{(}
        \PYG{n}{formula}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord \PYGZti{} 0 | 0 | 0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
        \PYG{n}{m} \PYG{o}{=} \PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{n}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,}
        \PYG{n}{pi}\PYG{o}{=}\PYG{n}{pi}\PYG{p}{,} \PYG{n}{xi}\PYG{o}{=}\PYG{n}{xi}\PYG{p}{,} \PYG{n}{phi}\PYG{o}{=}\PYG{n}{phi}\PYG{p}{,}
        \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1976}
    \PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} add a shelter category at c=1}
    \PYG{n}{df}\PYG{p}{[}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ord}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{concatenate}\PYG{p}{(}\PYG{p}{(}
        \PYG{n}{drawn}\PYG{o}{.}\PYG{n}{rv}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{repeat}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{25}\PYG{p}{)}
    \PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} MULTI\PYGZhy{}CUB}
\PYG{n}{multi}\PYG{p}{(}
    \PYG{n}{ords}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,} \PYG{n}{ms}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cub}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} MULTI\PYGZhy{}CUBE}
\PYG{n}{multi}\PYG{p}{(}
    \PYG{n}{ords}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,} \PYG{n}{ms}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cube}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} MULTI\PYGZhy{}CUBSH}
\PYG{n}{multi}\PYG{p}{(}
    \PYG{n}{ords}\PYG{o}{=}\PYG{n}{df}\PYG{p}{,} \PYG{n}{ms}\PYG{o}{=}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{n}{model}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cub}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{shs}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
    \PYG{n}{pos}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{multicub}.png}

\noindent\sphinxincludegraphics{{multicube}.png}

\noindent\sphinxincludegraphics{{multicubsh}.png}

\sphinxstepscope


\chapter{cubmods}
\label{\detokenize{modules:cubmods}}\label{\detokenize{modules::doc}}
\sphinxstepscope


\section{cubmods package}
\label{\detokenize{cubmods:cubmods-package}}\label{\detokenize{cubmods::doc}}

\subsection{Submodules}
\label{\detokenize{cubmods:submodules}}

\subsection{cubmods.cub module}
\label{\detokenize{cubmods:cubmods-cub-module}}

\subsection{cubmods.cub\_0w module}
\label{\detokenize{cubmods:cubmods-cub-0w-module}}

\subsection{cubmods.cub\_y0 module}
\label{\detokenize{cubmods:cubmods-cub-y0-module}}

\subsection{cubmods.cub\_yw module}
\label{\detokenize{cubmods:cubmods-cub-yw-module}}

\subsection{cubmods.cube module}
\label{\detokenize{cubmods:cubmods-cube-module}}

\subsection{cubmods.cube\_0w0 module}
\label{\detokenize{cubmods:cubmods-cube-0w0-module}}

\subsection{cubmods.cube\_ywz module}
\label{\detokenize{cubmods:cubmods-cube-ywz-module}}

\subsection{cubmods.cubsh module}
\label{\detokenize{cubmods:cubmods-cubsh-module}}

\subsection{cubmods.cubsh\_ywx module}
\label{\detokenize{cubmods:cubmods-cubsh-ywx-module}}

\subsection{cubmods.cush module}
\label{\detokenize{cubmods:cubmods-cush-module}}

\subsection{cubmods.cush2 module}
\label{\detokenize{cubmods:cubmods-cush2-module}}

\subsection{cubmods.cush2\_x0 module}
\label{\detokenize{cubmods:cubmods-cush2-x0-module}}

\subsection{cubmods.cush2\_xx module}
\label{\detokenize{cubmods:cubmods-cush2-xx-module}}

\subsection{cubmods.cush\_x module}
\label{\detokenize{cubmods:cubmods-cush-x-module}}

\subsection{cubmods.gem module}
\label{\detokenize{cubmods:cubmods-gem-module}}

\subsection{cubmods.general module}
\label{\detokenize{cubmods:cubmods-general-module}}

\subsection{cubmods.ihg module}
\label{\detokenize{cubmods:cubmods-ihg-module}}

\subsection{cubmods.ihg\_v module}
\label{\detokenize{cubmods:cubmods-ihg-v-module}}

\subsection{cubmods.multicub module}
\label{\detokenize{cubmods:cubmods-multicub-module}}

\subsection{cubmods.smry module}
\label{\detokenize{cubmods:cubmods-smry-module}}

\subsection{Module contents}
\label{\detokenize{cubmods:module-cubmods}}\label{\detokenize{cubmods:module-contents}}\index{module@\spxentry{module}!cubmods@\spxentry{cubmods}}\index{cubmods@\spxentry{cubmods}!module@\spxentry{module}}
\sphinxstepscope


\chapter{References}
\label{\detokenize{references:references}}\label{\detokenize{references::doc}}

\chapter{Indices and tables}
\label{\detokenize{index:indices-and-tables}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}

\begin{sphinxthebibliography}{IPSMaint}
\bibitem[CP17]{references:id11}
\sphinxAtStartPar
Stefania Capecchi and Domenico Piccolo. Dealing with heterogeneity in ordinal responses. \sphinxstyleemphasis{Quality \& Quantity}, 51:2375\textendash{}2393, 2017.
\bibitem[CSDI+21]{references:id28}
\sphinxAtStartPar
Giovanni Cerulli, R Simone, Francesca Di Iorio, D Piccolo, CF Baum, and others. The Stata module for CUB models for rating data analysis. In \sphinxstyleemphasis{London Stata Conference 2021}, number 16. Stata Users Group, 2021.
\bibitem[CIP09]{references:id10}
\sphinxAtStartPar
Marcella Corduas, Maria Iannario, and Domenico Piccolo. A class of statistical models for evaluating services and performances. In \sphinxstyleemphasis{Statistical methods for the evaluation of educational services and quality of products}, pages 99\textendash{}117. Springer, 2009.
\bibitem[DEliaP+05]{references:id18}
\sphinxAtStartPar
A D\textquotesingle{}Elia, Domenico Piccolo, and others. The moment estimator for the IHG distribution. In \sphinxstyleemphasis{S. Co. Modelli complessi e metodi computazionali intensivi per la stima e la previsione}, pages 245\textendash{}250. CLEUP, 2005.
\bibitem[DEliaP05]{references:id5}
\sphinxAtStartPar
Angela D\textquotesingle{}Elia and Domenico Piccolo. A mixture model for preferences data analysis. \sphinxstyleemphasis{Computational Statistics \& Data Analysis}, 49(3):917\textendash{}934, 2005.
\bibitem[DElia03]{references:id17}
\sphinxAtStartPar
Angela D’Elia. Modelling ranks using the inverse hypergeometric distribution. \sphinxstyleemphasis{Statistical modelling}, 3(1):65\textendash{}78, 2003.
\bibitem[Ian12a]{references:id15}
\sphinxAtStartPar
Maria Iannario. Cube models for interpreting ordered categorical data with overdispersion. \sphinxstyleemphasis{Quaderni di statistica}, 14:137\textendash{}140, 2012.
\bibitem[Ian12b]{references:id9}
\sphinxAtStartPar
Maria Iannario. Modelling shelter choices in a class of mixture models for ordinal responses. \sphinxstyleemphasis{Statistical Methods \& Applications}, 21:1\textendash{}22, 2012.
\bibitem[Ian14]{references:id16}
\sphinxAtStartPar
Maria Iannario. Modelling uncertainty and overdispersion in ordinal data. \sphinxstyleemphasis{Communications in Statistics\sphinxhyphen{}Theory and Methods}, 43(4):771\textendash{}786, 2014.
\bibitem[IP09]{references:id20}
\sphinxAtStartPar
Maria Iannario and Domenico Piccolo. A program in R for CUB models inference. \sphinxstyleemphasis{Available via Internet, URL http://www. dipstat. unina. it/CUBmodels/, Version}, 2009.
\bibitem[IP10]{references:id8}
\sphinxAtStartPar
Maria Iannario and Domenico Piccolo. A new statistical model for the analysis of customer satisfaction. \sphinxstyleemphasis{Quality Technology \& Quantitative Management}, 7(2):149\textendash{}168, 2010.
\bibitem[IP+14]{references:id21}
\sphinxAtStartPar
Maria Iannario, Domenico Piccolo, and others. Inference for CUB models: a program in R. \sphinxstyleemphasis{Statistica \& Applicazioni}, 12(2):177\textendash{}204, 2014.
\bibitem[IPSMaintainer22]{references:id22}
\sphinxAtStartPar
Maria Iannario, Domenico Piccolo, and Rosaria Simone (Maintainer). Package ‘CUB’. \sphinxstyleemphasis{CRAN}, 2022.
\bibitem[Pic03]{references:id4}
\sphinxAtStartPar
Domenico Piccolo. On the moments of a mixture of uniform and shifted binomial random variables. \sphinxstyleemphasis{Quaderni di Statistica}, 5(1):85\textendash{}104, 2003.
\bibitem[Pic06]{references:id7}
\sphinxAtStartPar
Domenico Piccolo. Observed information matrix for MUB models. \sphinxstyleemphasis{Quaderni di Statistica}, 8(1):33\textendash{}78, 2006.
\bibitem[Pic15]{references:id14}
\sphinxAtStartPar
Domenico Piccolo. Inferential issues on cube models with covariates. \sphinxstyleemphasis{Communications in Statistics\sphinxhyphen{}Theory and Methods}, 44(23):5023\textendash{}5036, 2015.
\bibitem[PS19]{references:id3}
\sphinxAtStartPar
Domenico Piccolo and Rosaria Simone. The class of CUB models: statistical foundations, inferential issues and empirical evidence (with discussion and rejoinder). \sphinxstyleemphasis{Statistical Methods \& Applications}, 28:389\textendash{}493, 2019.
\bibitem[Pie24]{references:id41}
\sphinxAtStartPar
Massimo Pierini. Modelli della classe CUB in python. \sphinxstyleemphasis{Universitas Mercatorum, Rome, IT}, pages 1\textendash{}172, June 2024. (Bachelor\textquotesingle{}s thesis L\sphinxhyphen{}41).
\bibitem[PL20]{references:id27}
\sphinxAtStartPar
W Stephen Pittard and Shuzhao Li. The essential toolbox of data science: python, R, git, and docker. \sphinxstyleemphasis{Computational Methods and Data Analysis for Metabolomics}, pages 265\textendash{}311, 2020.
\bibitem[Sim22]{references:id12}
\sphinxAtStartPar
Rosaria Simone. On finite mixtures of Discretized Beta model for ordered responses. \sphinxstyleemphasis{TEST}, 31(3):828\textendash{}855, 2022.
\bibitem[SDIL19]{references:id29}
\sphinxAtStartPar
Rosaria Simone, Francesca Di Iorio, and Riccardo Lucchetti. CUB for gretl. \sphinxstyleemphasis{GNU Regression, Econometrics and Time Series Library}, pages 147, 2019.
\end{sphinxthebibliography}


\renewcommand{\indexname}{Python Module Index}
\begin{sphinxtheindex}
\let\bigletter\sphinxstyleindexlettergroup
\bigletter{c}
\item\relax\sphinxstyleindexentry{cubmods}\sphinxstyleindexpageref{cubmods:\detokenize{module-cubmods}}
\end{sphinxtheindex}

\renewcommand{\indexname}{Index}
\printindex
\end{document}